(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.img = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";

module.exports = img;

var _utils = require("./utils");

var load_image = _utils.load_image;
var create_image_data = _utils.create_image_data;

function img(src) {
  return unit(src);
}

var proto = {};

function unit(src) {
  var promise = src instanceof Promise ? src : load_image(src);

  promise["catch"](function (e) {
    console.log("load promise failed", e);
  });

  var monad = Object.create(proto);

  monad.bind = function (func) {
    for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
      args[_key - 1] = arguments[_key];
    }

    return unit(promise.then(function (img) {
      return func.apply(undefined, [img].concat(args));
    }));
  };

  return monad;
}

function lift(name, func) {
  proto[name] = function () {
    var _ref;

    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    return (_ref = this).bind.apply(_ref, [func].concat(args));
  };
}

lift("outputTo", function outputTo(data, el) {
  var c = document.createElement("canvas");
  c.width = data.width;c.height = data.height;

  var ctx = c.getContext("2d");
  ctx.putImageData(data, 0, 0);

  var node = new Image();
  node.src = c.toDataURL("image/png");

  el.innerHTML = "";
  el.appendChild(node);
});

lift("identity", function (data) {
  var new_data = create_image_data(data.width, data.height);
  var cur_pos, new_pos;

  for (var x = 0; x < data.width; ++x) {
    for (var y = 0; y < data.height; ++y) {
      cur_pos = (y * data.width + x) * 4;
      new_pos = (y * data.width + x) * 4;

      new_data.data[new_pos] = data.data[cur_pos];
      new_data.data[new_pos + 1] = data.data[cur_pos + 1];
      new_data.data[new_pos + 2] = data.data[cur_pos + 2];
      new_data.data[new_pos + 3] = data.data[cur_pos + 3];
    }
  }

  return new_data;
});

lift("flipY", function (data) {
  var new_data = create_image_data(data.width, data.height);
  var cur_pos, new_pos;

  for (var x = 0; x < data.width; ++x) {
    for (var y = 0; y < data.height; ++y) {
      cur_pos = (y * data.width + x) * 4;
      new_pos = ((data.height - y - 1) * data.width + x) * 4;

      new_data.data[new_pos] = data.data[cur_pos];
      new_data.data[new_pos + 1] = data.data[cur_pos + 1];
      new_data.data[new_pos + 2] = data.data[cur_pos + 2];
      new_data.data[new_pos + 3] = data.data[cur_pos + 3];
    }
  }

  return new_data;
});

lift("flipX", function (data) {
  var new_data = create_image_data(data.width, data.height);
  var cur_pos, new_pos;

  for (var x = 0; x < data.width; ++x) {
    for (var y = 0; y < data.height; ++y) {
      cur_pos = (y * data.width + x) * 4;
      new_pos = (y * data.width + (data.width - x - 1)) * 4;

      new_data.data[new_pos] = data.data[cur_pos];
      new_data.data[new_pos + 1] = data.data[cur_pos + 1];
      new_data.data[new_pos + 2] = data.data[cur_pos + 2];
      new_data.data[new_pos + 3] = data.data[cur_pos + 3];
    }
  }

  return new_data;
});

lift("inverse", function (data) {
  var new_data = create_image_data(data.width, data.height);
  var cur_pos, new_pos;

  for (var x = 0; x < data.width; ++x) {
    for (var y = 0; y < data.height; ++y) {
      cur_pos = (y * data.width + x) * 4;
      new_pos = (y * data.width + x) * 4;

      new_data.data[new_pos] = 255 - data.data[cur_pos];
      new_data.data[new_pos + 1] = 255 - data.data[cur_pos + 1];
      new_data.data[new_pos + 2] = 255 - data.data[cur_pos + 2];
      new_data.data[new_pos + 3] = data.data[cur_pos + 3];
    }
  }

  return new_data;
});

},{"./utils":2}],2:[function(require,module,exports){
"use strict";

exports.load_image = load_image;
exports.create_image_data = create_image_data;
Object.defineProperty(exports, "__esModule", {
  value: true
});

function load_image(src) {
  if (src instanceof Image) {
    return new Promise(function (accept) {
      accept(src);
    });
  }

  return new Promise(function (accept, reject) {
    var img = new Image();
    img.onload = function () {
      var c = document.createElement("canvas");
      c.width = img.width;c.height = img.height;

      var ctx = c.getContext("2d");
      ctx.drawImage(img, 0, 0);

      var image_data = ctx.getImageData(0, 0, c.width, c.height);

      accept(image_data);
      img = null;
    };

    img.onerror = function (err) {
      reject(err);
      img = null;
    };

    img.src = src;
  });
}

function create_image_data(width, height) {
  var c = document.createElement("canvas");

  return c.getContext("2d").createImageData(width, height);
}

},{}]},{},[1])(1)
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvVXNlcnMvZHBldHJvdi9jb2RlL2pzL2ltZy5qcy9saWIvaW1nLmpzIiwiL1VzZXJzL2RwZXRyb3YvY29kZS9qcy9pbWcuanMvbGliL3V0aWxzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7aUJDSXdCLEdBQUc7O3FCQUZpQixTQUFTOztJQUE3QyxVQUFVLFVBQVYsVUFBVTtJQUFFLGlCQUFpQixVQUFqQixpQkFBaUI7O0FBRXRCLFNBQVMsR0FBRyxDQUFDLEdBQUcsRUFBRTtBQUMvQixTQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztDQUNsQjs7QUFFRCxJQUFJLEtBQUssR0FBRyxFQUFFLENBQUM7O0FBRWYsU0FBUyxJQUFJLENBQUMsR0FBRyxFQUFFO0FBQ2pCLE1BQUksT0FBTyxHQUFHLEdBQUcsWUFBWSxPQUFPLEdBQUcsR0FBRyxHQUFHLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQzs7QUFFN0QsU0FBTyxTQUFNLENBQUMsVUFBUyxDQUFDLEVBQUU7QUFDeEIsV0FBTyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLENBQUMsQ0FBQztHQUN2QyxDQUFDLENBQUM7O0FBRUgsTUFBSSxLQUFLLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQzs7QUFFakMsT0FBSyxDQUFDLElBQUksR0FBRyxVQUFTLElBQUksRUFBVztzQ0FBTixJQUFJO0FBQUosVUFBSTs7O0FBQ2pDLFdBQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsVUFBUyxHQUFHLEVBQUU7QUFDckMsYUFBTyxJQUFJLG1CQUFDLEdBQUcsU0FBSyxJQUFJLEVBQUMsQ0FBQztLQUMzQixDQUFDLENBQUMsQ0FBQztHQUNMLENBQUM7O0FBRUYsU0FBTyxLQUFLLENBQUM7Q0FDZDs7QUFFRCxTQUFTLElBQUksQ0FBQyxJ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RUFBRSxNQUFNLENBQUMsQ0FBQztDQUMxRCIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJcInVzZSBzdHJpY3RcIlxuXG5pbXBvcnQge2xvYWRfaW1hZ2UsIGNyZWF0ZV9pbWFnZV9kYXRhfSBmcm9tICcuL3V0aWxzJ1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBpbWcoc3JjKSB7XG4gIHJldHVybiB1bml0KHNyYyk7XG59XG5cbnZhciBwcm90byA9IHt9O1xuXG5mdW5jdGlvbiB1bml0KHNyYykge1xuICB2YXIgcHJvbWlzZSA9IHNyYyBpbnN0YW5jZW9mIFByb21pc2UgPyBzcmMgOiBsb2FkX2ltYWdlKHNyYyk7XG5cbiAgcHJvbWlzZS5jYXRjaChmdW5jdGlvbihlKSB7XG4gICAgY29uc29sZS5sb2coJ2xvYWQgcHJvbWlzZSBmYWlsZWQnLCBlKTtcbiAgfSk7XG5cbiAgdmFyIG1vbmFkID0gT2JqZWN0LmNyZWF0ZShwcm90byk7XG5cbiAgbW9uYWQuYmluZCA9IGZ1bmN0aW9uKGZ1bmMsIC4uLmFyZ3MpIHtcbiAgICByZXR1cm4gdW5pdChwcm9taXNlLnRoZW4oZnVuY3Rpb24oaW1nKSB7XG4gICAgICByZXR1cm4gZnVuYyhpbWcsIC4uLmFyZ3MpO1xuICAgIH0pKTtcbiAgfTtcblxuICByZXR1cm4gbW9uYWQ7XG59XG5cbmZ1bmN0aW9uIGxpZnQobmFtZSwgZnVuYykge1xuICBwcm90b1tuYW1lXSA9IGZ1bmN0aW9uKC4uLmFyZ3MpIHtcbiAgICByZXR1cm4gdGhpcy5iaW5kKGZ1bmMsIC4uLmFyZ3MpO1xuICB9O1xufVxuXG5saWZ0KCdvdXRwdXRUbycsIGZ1bmN0aW9uIG91dHB1dFRvKGRhdGEsIGVsKSB7XG4gIHZhciBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gIGMud2lkdGggPSBkYXRhLndpZHRoOyBjLmhlaWdodCA9IGRhdGEuaGVpZ2h0O1xuXG4gIHZhciBjdHggPSBjLmdldENvbnRleHQoJzJkJyk7XG4gIGN0eC5wdXRJbWFnZURhdGEoZGF0YSwgMCwgMCk7XG5cbiAgdmFyIG5vZGUgPSBuZXcgSW1hZ2UoKTtcbiAgbm9kZS5zcmMgPSBjLnRvRGF0YVVSTChcImltYWdlL3BuZ1wiKTtcblxuICBlbC5pbm5lckhUTUwgPSAnJztcbiAgZWwuYXBwZW5kQ2hpbGQobm9kZSk7XG59KTtcblxubGlmdCgnaWRlbnRpdHknLCBmdW5jdGlvbihkYXRhKSB7XG4gIHZhciBuZXdfZGF0YSA9IGNyZWF0ZV9pbWFnZV9kYXRhKGRhdGEud2lkdGgsIGRhdGEuaGVpZ2h0KTtcbiAgdmFyIGN1cl9wb3MsIG5ld19wb3M7XG5cbiAgZm9yICh2YXIgeCA9IDA7IHggPCBkYXRhLndpZHRoOyArK3gpIHtcbiAgICBmb3IgKHZhciB5ID0gMDsgeSA8IGRhdGEuaGVpZ2h0OyArK3kpIHtcbiAgICAgIGN1cl9wb3MgPSAoeSAqIGRhdGEud2lkdGggKyB4KSAqIDQ7XG4gICAgICBuZXdfcG9zID0gKHkgKiBkYXRhLndpZHRoICsgeCkgKiA0O1xuXG4gICAgICBuZXdfZGF0YS5kYXRhW25ld19wb3NdID0gZGF0YS5kYXRhW2N1cl9wb3NdO1xuICAgICAgbmV3X2RhdGEuZGF0YVtuZXdfcG9zICsgMV0gPSBkYXRhLmRhdGFbY3VyX3BvcyArIDFdO1xuICAgICAgbmV3X2RhdGEuZGF0YVtuZXdfcG9zICsgMl0gPSBkYXRhLmRhdGFbY3VyX3BvcyArIDJdO1xuICAgICAgbmV3X2RhdGEuZGF0YVtuZXdfcG9zICsgM10gPSBkYXRhLmRhdGFbY3VyX3BvcyArIDNdO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBuZXdfZGF0YTtcbn0pO1xuXG5saWZ0KCdmbGlwWScsIGZ1bmN0aW9uKGRhdGEpIHtcbiAgdmFyIG5ld19kYXRhID0gY3JlYXRlX2ltYWdlX2RhdGEoZGF0YS53aWR0aCwgZGF0YS5oZWlnaHQpO1xuICB2YXIgY3VyX3BvcywgbmV3X3BvcztcblxuICBmb3IgKHZhciB4ID0gMDsgeCA8IGRhdGEud2lkdGg7ICsreCkge1xuICAgIGZvciAodmFyIHkgPSAwOyB5IDwgZGF0YS5oZWlnaHQ7ICsreSkge1xuICAgICAgY3VyX3BvcyA9ICh5ICogZGF0YS53aWR0aCArIHgpICogNDtcbiAgICAgIG5ld19wb3MgPSAoKGRhdGEuaGVpZ2h0IC0geSAtIDEpICogZGF0YS53aWR0aCArIHgpICogNDtcblxuICAgICAgbmV3X2RhdGEuZGF0YVtuZXdfcG9zXSA9IGRhdGEuZGF0YVtjdXJfcG9zXTtcbiAgICAgIG5ld19kYXRhLmRhdGFbbmV3X3BvcyArIDFdID0gZGF0YS5kYXRhW2N1cl9wb3MgKyAxXTtcbiAgICAgIG5ld19kYXRhLmRhdGFbbmV3X3BvcyArIDJdID0gZGF0YS5kYXRhW2N1cl9wb3MgKyAyXTtcbiAgICAgIG5ld19kYXRhLmRhdGFbbmV3X3BvcyArIDNdID0gZGF0YS5kYXRhW2N1cl9wb3MgKyAzXTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gbmV3X2RhdGE7XG59KTtcblxubGlmdCgnZmxpcFgnLCBmdW5jdGlvbihkYXRhKSB7XG4gIHZhciBuZXdfZGF0YSA9IGNyZWF0ZV9pbWFnZV9kYXRhKGRhdGEud2lkdGgsIGRhdGEuaGVpZ2h0KTtcbiAgdmFyIGN1cl9wb3MsIG5ld19wb3M7XG5cbiAgZm9yICh2YXIgeCA9IDA7IHggPCBkYXRhLndpZHRoOyArK3gpIHtcbiAgICBmb3IgKHZhciB5ID0gMDsgeSA8IGRhdGEuaGVpZ2h0OyArK3kpIHtcbiAgICAgIGN1cl9wb3MgPSAoeSAqIGRhdGEud2lkdGggKyB4KSAqIDQ7XG4gICAgICBuZXdfcG9zID0gKHkgKiBkYXRhLndpZHRoICsgKGRhdGEud2lkdGggLSB4IC0gMSkpICogNDtcblxuICAgICAgbmV3X2RhdGEuZGF0YVtuZXdfcG9zXSA9IGRhdGEuZGF0YVtjdXJfcG9zXTtcbiAgICAgIG5ld19kYXRhLmRhdGFbbmV3X3BvcyArIDFdID0gZGF0YS5kYXRhW2N1cl9wb3MgKyAxXTtcbiAgICAgIG5ld19kYXRhLmRhdGFbbmV3X3BvcyArIDJdID0gZGF0YS5kYXRhW2N1cl9wb3MgKyAyXTtcbiAgICAgIG5ld19kYXRhLmRhdGFbbmV3X3BvcyArIDNdID0gZGF0YS5kYXRhW2N1cl9wb3MgKyAzXTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gbmV3X2RhdGE7XG59KTtcblxubGlmdCgnaW52ZXJzZScsIGZ1bmN0aW9uKGRhdGEpIHtcbiAgdmFyIG5ld19kYXRhID0gY3JlYXRlX2ltYWdlX2RhdGEoZGF0YS53aWR0aCwgZGF0YS5oZWlnaHQpO1xuICB2YXIgY3VyX3BvcywgbmV3X3BvcztcblxuICBmb3IgKHZhciB4ID0gMDsgeCA8IGRhdGEud2lkdGg7ICsreCkge1xuICAgIGZvciAodmFyIHkgPSAwOyB5IDwgZGF0YS5oZWlnaHQ7ICsreSkge1xuICAgICAgY3VyX3BvcyA9ICh5ICogZGF0YS53aWR0aCArIHgpICogNDtcbiAgICAgIG5ld19wb3MgPSAoeSAqIGRhdGEud2lkdGggKyB4KSAqIDQ7XG5cbiAgICAgIG5ld19kYXRhLmRhdGFbbmV3X3Bvc10gPSAyNTUgLSBkYXRhLmRhdGFbY3VyX3Bvc107XG4gICAgICBuZXdfZGF0YS5kYXRhW25ld19wb3MgKyAxXSA9IDI1NSAtIGRhdGEuZGF0YVtjdXJfcG9zICsgMV07XG4gICAgICBuZXdfZGF0YS5kYXRhW25ld19wb3MgKyAyXSA9IDI1NSAtIGRhdGEuZGF0YVtjdXJfcG9zICsgMl07XG4gICAgICBuZXdfZGF0YS5kYXRhW25ld19wb3MgKyAzXSA9IGRhdGEuZGF0YVtjdXJfcG9zICsgM107XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIG5ld19kYXRhO1xufSk7XG4iLCJleHBvcnQgZnVuY3Rpb24gbG9hZF9pbWFnZShzcmMpIHtcbiAgaWYgKHNyYyBpbnN0YW5jZW9mIEltYWdlKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKGFjY2VwdCkge1xuICAgICAgYWNjZXB0KHNyYyk7XG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24oYWNjZXB0LCByZWplY3QpIHtcbiAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7XG4gICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICAgIGMud2lkdGggPSBpbWcud2lkdGg7IGMuaGVpZ2h0ID0gaW1nLmhlaWdodDtcblxuICAgICAgdmFyIGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgIGN0eC5kcmF3SW1hZ2UoaW1nLCAwLCAwKTtcblxuICAgICAgdmFyIGltYWdlX2RhdGEgPSBjdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIGMud2lkdGgsIGMuaGVpZ2h0KTtcblxuICAgICAgYWNjZXB0KGltYWdlX2RhdGEpO1xuICAgICAgaW1nID0gbnVsbDtcbiAgICB9O1xuXG4gICAgaW1nLm9uZXJyb3IgPSBmdW5jdGlvbihlcnIpIHtcbiAgICAgIHJlamVjdChlcnIpO1xuICAgICAgaW1nID0gbnVsbDtcbiAgICB9O1xuXG4gICAgaW1nLnNyYyA9IHNyYztcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVfaW1hZ2VfZGF0YSh3aWR0aCwgaGVpZ2h0KSB7XG4gIHZhciBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG5cbiAgcmV0dXJuIGMuZ2V0Q29udGV4dChcIjJkXCIpLmNyZWF0ZUltYWdlRGF0YSh3aWR0aCwgaGVpZ2h0KTtcbn1cbiJdfQ==
